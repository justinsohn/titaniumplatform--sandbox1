<template>
  <lightning-card title="Resource Planning Dashboard">
    <div class="slds-p-around_medium">
      <!-- Summary Cards -->
      <div class="summary-card">
        <div class="summary-item">
          <div class="summary-label">Total Resources</div>
          <div class="summary-value">{totalResources}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Hours</div>
          <div class="summary-value">{totalHours}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Cost</div>
          <div class="summary-value">{totalCostFormatted}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Revenue</div>
          <div class="summary-value">{totalRevenueFormatted}</div>
        </div>
      </div>

      <!-- Table Container -->
      <div class="schedule-container">
        <div class="table-wrapper">
          <table class="schedule-table slds-table">
            <thead>
              <tr>
                <th class="fixed-column task-resource-cell" rowspan="3">
                  <div>Task - Resource</div>
                </th>
                <template for:each={visibleMonths} for:item="month">
                  <th key={month} class="week-header">
                    <div class="week-label">{month}</div>
                  </th>
                </template>
                <th rowspan="3" class="week-header">
                  <div class="week-label">Totals</div>
                </th>
              </tr>
            </thead>
            <tbody>
              <template for:each={visibleTableDataMonthly} for:item="row">
                <tr key={row.id} class="resource-row">
                  <td class="fixed-column task-resource-cell" rowspan="3">
                    <div class="resource-info">
                      <div class="resource-name">{row.taskAndResource}</div>
                      <div class="allocation-info">
                        <div class="allocation-header">
                          <span class="allocation-percentage"
                            >{row.allocationPercentage}% Allocated</span
                          >
                          <span class="available-hours"
                            >{row.rowTotalHours} / {row.totalAssignmentHours}
                            hrs</span
                          >
                        </div>
                        <div class="allocation-bar">
                          <div
                            class="allocation-fill {row.allocationClass}"
                            style={row.allocationStyle}
                          ></div>
                        </div>
                        <div class="hours-breakdown">
                          <span class="hours-label"
                            >Available: {row.remainingHours} hrs</span
                          >
                        </div>
                      </div>
                      <div class="resource-rates">
                        <span class="rate-label"
                          >Cost Rate: {row.costRateFormatted}/hr</span
                        >
                        <span class="rate-label"
                          >Bill Rate: {row.billRateFormatted}/hr</span
                        >
                      </div>
                    </div>
                  </td>
                  <template for:each={row.monthlyData} for:item="monthData">
                    <td key={monthData.key} class="hours-cell">
                      <div class="hours-value">{monthData.hours}</div>
                    </td>
                  </template>
                  <td rowspan="3" class="totals-cell">
                    <div class="total-value">{row.rowTotalHours} hrs</div>
                  </td>
                </tr>
                <tr key={row.costRowKey} class="cost-row">
                  <template for:each={row.monthlyData} for:item="monthData">
                    <td key={monthData.costKey} class="calculated-cell">
                      <div class="calculated-value cost">
                        {monthData.costFormatted}
                      </div>
                    </td>
                  </template>
                </tr>
                <tr key={row.revenueRowKey} class="revenue-row">
                  <template for:each={row.monthlyData} for:item="monthData">
                    <td key={monthData.revenueKey} class="calculated-cell">
                      <div class="calculated-value revenue">
                        {monthData.revenueFormatted}
                      </div>
                    </td>
                  </template>
                </tr>
              </template>
              <!-- Column Totals -->
              <tr class="totals-row">
                <td class="fixed-column">
                  <strong>Monthly Totals</strong>
                </td>
                <template
                  for:each={visibleColumnTotalsMonthly}
                  for:item="total"
                >
                  <td key={total.month} class="column-total">
                    <div class="total-hours">{total.hours} hrs</div>
                    <div class="total-cost">{total.costFormatted}</div>
                    <div class="total-revenue">{total.revenueFormatted}</div>
                  </td>
                </template>
                <td class="grand-total">
                  <div class="total-hours">{grandTotalHours} hrs</div>
                  <div class="total-cost">{grandTotalCostFormatted}</div>
                  <div class="total-revenue">{grandTotalRevenueFormatted}</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </lightning-card>
</template>
